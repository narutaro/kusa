<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs -->
  <meta charset="utf-8">
  <title>KUSA</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="images/favicon.png">

  <script type="text/javascript" src="//d3js.org/d3.v3.min.js"></script>
  <script type="text/javascript" src="//cdn.jsdelivr.net/cal-heatmap/3.3.10/cal-heatmap.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/cal-heatmap/3.3.10/cal-heatmap.css" />

  <!-- Application configuration -->
  <script type="text/javascript" src=".app_config.js"></script>

  <!-- Fontawsome -->
  <script src="https://kit.fontawesome.com/a1763a7d6f.js" crossorigin="anonymous"></script>



</head>
<body>

<div class="container" style="margin-top: 20px">
  <div class="menu">
    <div class="left-content"><img src="img/kusa-h40.png"></img></div>
    <div class="right-content"><i class="fas fa-bars" style="font-size: 2em"></i></div>
  </div>
</div><!-- container -->


  <!-- Primary Page Layout -->
<div class="container" style="margin-top: 50px">
  <div class="row">
    <div class="twelve columns"><div id="cal-heatmap"></div></div>
    <div class="twelve columns" style="margin-top:100px">
      <button class="u-full-width" onclick="go(url, createData()); cal.update(url)"><i class="fas fa-tint"></i> grow!</button>
    </div>
    </div>
  </div>

</body>

<script type="text/javascript">

var url = conf.url

function epoch() {
  var date = new Date() ;
  return Math.floor( date.getTime() / 1000 ) ;
}

function createData() {
  var data = '{"' + epoch() + '"' + ':1}'
  return JSON.parse(data);
}

function go(url, data) {
  fetch(url, {
    method: 'PATCH', 
    body: JSON.stringify(data), 
    //body: data, 
    headers:{ 'Content-Type': 'application/json' }
  }).then(res => res.json())
  .then(response => console.log('Success:', JSON.stringify(response)))
  .catch(error => console.error('Error:', error));
}

const d = new Date();
let threeMonthAgo = d.setMonth(d.getMonth() - 2);


var cal = new CalHeatMap();
cal.init({
  start: threeMonthAgo,
  range: 3,
  cellSize: 15,
  domain: "month",
  domainGutter: 0,
  domainMargin: 0,
  weekStartOnMonday: false,
/*
  verticalOrientation: true,
  legendOrientation: "vertical",
  legendHorizontalPosition: "right",
  legendVerticalPosition: "center",
  legendMargin: [0, 0, 0, 20],
*/
  //data: "date.json",
  data: url,
  tooltip: true
});

</script>

<style>

/* menu */
.menu {
  width: 100%;
  /* background-color: gray; */
  display: table;
}

.left-content {
  width: 10%;
  display: table-cell;
  /* padding: 20px 20px 20px 20px; */
}

.right-content {
  width: 90%;
  display: table-cell;
  text-align : right;
  vertical-align: middle;
  /* padding: 20px 20px 20px 20px; */
}

</style>

</html>

